<!DOCTYPE html>

<html>
    <head>
        <title>Upload | Virtual Light Table</title>
        <link rel="stylesheet" type="text/css" href="upload.css"/>
        <script src="../js/libs/jquery-3.6.0.min.js"></script>
        <script>window.$ = window.jQuery = require('../js/libs/jquery-3.6.0.min.js');</script>
    </head>
    <body> 
        <!-- CANVAS REGION / UPPER REGION -->
        <div class="wrapper" id="upper_region">
            <!-- CANVASES -->
            <div class="wrapper" id="canvas_region">
                <div class="wrapper canvas_wrapper" id="recto_canvas_region">
                    <canvas class="move" id="recto_canvas"></canvas>
                    <div class="wrapper upload_wrapper" id="recto_upload_wrapper">
                        <div class="label upload_label">Upload Recto Image</div>
                        <div title="Upload a local image file from your computer" class="button large_button local_upload" canvas="recto">
                            <img draggable="false" src="../imgs/symbol_upload_local.png" canvas="recto">
                            <label canvas="recto">Local File</label>
                        </div>
                        <div title="Specify a URL to an image on the internet" class="button large_button www_upload" canvas="recto">
                            <img draggable="false" src="../imgs/symbol_www.png" canvas="recto">
                            <label canvas="recto">Web Image/URL</label>
                        </div>
                        <div title="Select other images from TPOP" class="button large_button choose_tpop unrendered" canvas="recto">
                            <img draggable="false" src="../imgs/symbol_magnifier.png" canvas="recto">
                            <label canvas="recto">TPOP Images</label>
                        </div>
                    </div>
                    <div class="overlay-drop drop" canvas="recto">
                        <div class="label drop">Drop Image Here to Register as Recto</div>
                        <img src="../imgs/symbol_upload_local.png" class="no-select drop">
                    </div>
                </div> <!-- </recto_canvas_region> -->
                <div class="wrapper canvas_wrapper" id="verso_canvas_region">
                    <canvas class="move" id="verso_canvas"></canvas>
                    <div class="wrapper upload_wrapper" id="verso_upload_wrapper">
                        <div class="label upload_label">Upload Verso Image</div>
                        <div title="Upload a local image file from your computer" class="button large_button local_upload" canvas="verso">
                            <img draggable="false" src="../imgs/symbol_upload_local.png" canvas="verso">
                            <label canvas="verso">Local File</label>
                        </div>
                        <div title="Specify a URL to an image on the internet" class="button large_button www_upload" canvas="verso">
                            <img draggable="false" src="../imgs/symbol_www.png" canvas="verso">
                            <label canvas="verso">Web Image/URL</label>
                        </div>
                        <div title="Select other images from TPOP" class="button large_button choose_tpop unrendered" canvas="verso">
                            <img draggable="false" src="../imgs/symbol_magnifier.png" canvas="verso">
                            <label canvas="verso">TPOP Images</label>
                        </div>
                    </div>
                    <div class="overlay-drop drop" canvas="verso">
                        <div class="label drop">Drop Image Here to Register as Verso</div>
                        <img src="../imgs/symbol_upload_local.png" class="no-select drop">
                    </div>
                </div> <!-- </verso_canvas_region> -->
            </div> <!-- </canvas_region> -->
            <!-- BUTTONS -->
            <div class="wrapper hidden" id="button_region">
                <div class="wrapper hidden" id="recto_button_region">
                    <div title="Remove image (doesn't delete any files on your computer)" class="button square delete" canvas="recto">
                        <img draggable="false" src="../imgs/symbol_bin.png" canvas="recto">
                    </div>
                    <div title="Rotate image by 90°" class="button square rotate_90" canvas="recto">
                        <img draggable="false" src="../imgs/symbol_rotate90-large.png" canvas="recto">
                    </div>
                    <div title="Recenter Image" class="button square center" canvas="recto">
                        <img draggable="false" src="../imgs/symbol_center.png" canvas="recto">
                    </div>
                    <div title="Measure PPI - Specify the distance of 1cm in the image" class="button square measure" id="measure_recto" mode="measure_recto" canvas="recto">
                        <img draggable="false" src="../imgs/symbol_measure_cursor.png" canvas="recto" mode="measure_recto">
                    </div>
                    <div class="ppi_wrapper">
                        <input type="text" class="input_ppi missing" id="recto_ppi" canvas="recto">
                        <div class="label label_ppi">ppi</div>
                    </div>
                    <div class="label canvas_title">Recto</div>
                </div>
                <div class="wrapper" id="general_button_region">
                    <div title="MOVE images" class="button square active_mode" id="move" mode="move">
                        <img draggable="false" src="../imgs/symbol_move.png" mode="move">
                    </div>
                    <div title="Swap images for Recto and Verso" class="button square" id="swap">
                        <img draggable="false" src="../imgs/symbol_switch.png">
                    </div>
                    <div title="ROTATE images" class="button square" id="rotate" mode="rotate">
                        <img draggable="false" src="../imgs/symbol_rotate.png" mode="rotate">
                    </div>
                </div>
                <div class="wrapper hidden" id="verso_button_region">
                    <div class="label canvas_title">Verso</div>
                    <div class="ppi_wrapper">
                        <input type="text" class="input_ppi missing" id="verso_ppi" canvas="verso">
                        <div class="label label_ppi">ppi</div>
                    </div>
                    <div title="Measure PPI - Specify the distance of 1cm in the image" class="button square measure" id="measure_verso" mode="measure_verso" canvas="verso">
                        <img draggable="false" src="../imgs/symbol_measure_cursor.png" canvas="verso" mode="measure_verso">
                    </div>
                    <div title="Recenter Image" class="button square center" canvas="verso">
                        <img draggable="false" src="../imgs/symbol_center.png" canvas="verso">
                    </div>
                    <div title="Rotate image by 90°" class="button square rotate_90" canvas="verso">
                        <img draggable="false" src="../imgs/symbol_rotate90-large.png" canvas="verso">
                    </div>
                    <div title="Remove image (doesn't delete any files on your computer)" class="button square delete" canvas="verso">
                        <img draggable="false" src="../imgs/symbol_bin.png" canvas="verso">
                    </div>
                </div>
            </div> <!-- </button_region> -->
        </div> <!-- </upper_region> -->

        <!-- LOWER REGION -->
        <div class="wrapper" id="lower_region">
            <div class="wrapper" id="manual_region">
                <div class="header">Upload Custom Fragment</div>
                <div id="manual_text">
                    <ul>
                        <li>CREATE front and back with local or web images,</li>
                        <li>RESIZE to bring objects to scale,</li>
                        <li>ALIGN front and back to each other,</li>
                        <li>NAME your object,</li>
                        <li>LOAD your object to the lighttable.</li>
                        <li><span class="red_text">Red fields</span> are obligatory.</li>
                    </ul>
                </div>
                <!-- removed for the release -->
                <!--
                    <div class="button large_button" id="manual_instructions">
                        <img draggable="false" src="../imgs/symbol_question.png">
                        <label>Instructions</label>
                    </div>
                -->
            </div> <!-- </manual_region> -->
            <div class="wrapper unrendered" id="mask_region">
                <div class="header">Mask & Register</div>
                <div id="mask_selection_region">
                    <div class="label" id="mask_selection_label">Select masking mode:</div>
                    <div class="list" id="mask_selection">
                        <div class="list_item selected no_mask" id="mask_none" mask_mode="no_mask">
                            <img draggable="false" src="../imgs/symbol_x.png" class="">
                            <div class="list_item_label label">No Mask</div>
                        </div>
                        <div class="list_item boundingbox" id="mask_boundingbox" mask_mode="boundingbox">
                            <img draggable="false" src="../imgs/symbol_crop.png" class="">
                            <div class="list_item_label label">Box</div>
                        </div>
                        <div class="list_item polygon" id="mask_polygon" mask_mode="polygon">
                            <img draggable="false" src="../imgs/symbol_cut.png" class="">
                            <div class="list_item_label label">Polygon</div>
                        </div>
                        <div class="list_item automatic automatic_cut" id="mask_automatic" mask_mode="automatic">
                            <img draggable="false" src="../imgs/symbol_ml.png" class="">
                            <div class="list_item_label label">Automatic</div>
                        </div>
                    </div>
                </div>
                <div id="mask_control_region">
                    <div class="mask_controls selected no_mask"></div>
                    <div class="mask_controls boundingbox">
                        <div title="Reset bounding box" id="reset_box" class="mask_control_button button square">
                            <img src="../imgs/symbol_rotate.png"/>
                        </div>
                    </div>
                    <div class="mask_controls polygon">
                        <div title="Add new polygon nodes (toggle)" id="add_polygon_node" mode="add_polygon_node" class="mask_control_button button square">
                            <img src="../imgs/symbol_cut.png" class="square_button_img" mode="add_polygon_node"/>
                        </div>
                        <div title="Remove polygon nodes (toggle)" id="remove_polygon_node" mode="remove_polygon_node" class="mask_control_button button square">
                            <img src="../imgs/symbol_erase.png" mode="remove_polygon_node"/>
                        </div>
                        <div title="Undo last polygon node" id="undo_polygon_node" class="mask_control_button button square">
                            <img src="../imgs/symbol_undo.png"/>
                        </div>
                        <div title="Remove all polygon nodes" id="clear_polygon" class="mask_control_button button square">
                            <img src="../imgs/symbol_new_table.png"/>
                        </div>
                    </div>
                    <div class="mask_controls_wrapper automatic automatic_cut">
                        <div id="mask_control_tensorflow_panel" class="mask_tensorflow_installer unrendered">
                            <div>The Virtual Light Table makes use of the python library <a href="https://tensorflow.org" target="_blank">Tensorflow</a> to enable its machine learning capabilites, including the automatic segmentation of objects. However, no working Tensorflow installment has been found. You can try to install the package via the <a href="#" id="open-settings">Settings</a> menu or <a hreF="https://www.tensorflow.org/install" target="_blank">install manually</a>.</div>
                        </div>
                        <div id="mask_control_automatic_selection_panel" class="mask_controls automatic automatic_cut unrendered">
                            <select id="mask_automatic_model">
                                <!-- <option value="model_id_a">BiNet_MultiClass_8.2 (284.42 MB)</option> -->
                                <!-- <option value="model_id_b">U-Net_MultiClass (218.23 MB)</option> -->
                                <!-- <option value="model_id_c">VisionTransformer_MultiClass (158.34 MB)</option> -->
                            </select>
                            <div class="button large_button" id="model-download" mode="download">
                                <img src="../imgs/symbol_download.png"/>
                                <label>Download Model</label>
                            </div>
                            <div class="button large_button" id="compute-mask" mode="compute">
                                <img src="../imgs/symbol_gear.png"/>
                                <label>Compute Mask</label>
                            </div>
                            <!-- <div class="button mask_control_button square unrendered" id="mask_selection_delete_model"> -->
                            <!-- <div class="button mask_control_button square" id="mask_selection_delete_model">
                                <img src="../imgs/symbol_bin.png"/>
                            </div> -->
                        </div>
                        <div id="mask_control_panel_automatic" class="mask_controls automatic automatic_cut unrendered wrapper-row">
                            <div class="wrapper-col" id="wrapper-brush">
                                <div class="wrapper-row">
                                    <div id="mask_control_automatic_draw" class="mask_control_button button square">
                                        <img src="../imgs/symbol_brush.png"/>
                                    </div>
                                    <div id="mask_control_automatic_erase" class="mask_control_button button square">
                                        <img src="../imgs/symbol_erase.png"/>
                                    </div>
                                </div>
                                <div class="wrapper-row">
                                    <img class="small_image" src="../imgs/symbol_size.png"/>
                                    <input type="range" min="1" max="100" value="50" id="mask_control_brush_slider">
                                </div>
                            </div>
                            <div class="wrapper-row" id="wrapper-light">
                                <input type="range" min="0" max="100" value="70" id="mask_control_opacity_slider">
                                <div class="wrapper-col" id="wrapper-light-symbols">
                                    <img class="small_image" src="../imgs/symbol_bright.png"/>
                                    <img class="small_image" src="../imgs/symbol_dark.png"/>
                                </div>
                            </div>
                            <div class="wrapper-row">
                                <div id="mask_control_automatic_cut" class="mask_control_button button large_button_flexible">
                                    <img src="../imgs/symbol_cut.png"/>
                                    <label>Cut</label>
                                </div>
                                <div id="mask_control_automatic_delete" class="mask_control_button button square">
                                    <img src="../imgs/symbol_bin.png"/>
                                </div>
                            </div>










                        </div>
                    </div>
                    <div id="mask_control_title"></div>
                </div>
                <div id="mask_explanation_region">
                    <div class="mask_explanation selected no_mask">No mask mode selected. Please note that correct flipping of images will only work if recto and verso are already perfectly aligned to each other.</div>
                    <div class="mask_explanation boundingbox">Move the vertices of the bounding box to define the minimal bounding rectangle for your object. Make sure for both recto and verso your object is in the selected region.</div>
                    <div class="mask_explanation polygon">Use the pen tool and add nodes to define a custom polygon around your object. Make sure that for both recto and verso your object is within the polygonal region.</div>
                    <div class="mask_explanation automatic">Select a machine learning model to automatically segment your object and register front and back to each other.</div>
                </div>
            </div> <!-- </mask_region> -->
            <div class="wrapper unrendered" id="load_region"> <!-- Level 2 -->
                <div class="header">Load Fragment</div>
                <div class="wrapper" id="load_region_wrapper">
                    <input class="missing" type="text" id="objectname">
                    <div class="label">Object Name</div>
                    <div title="Finish upload and add fragment to table" class="button large_button disabled" id="upload_button">
                        <img draggable="false" src="../imgs/symbol_plus_zoom.png" class="large_button_img">
                        <div class="large_button_label">Add to Table</div>
                    </div> 
                </div>
            </div> <!-- </load_region> -->
        </div> <!-- </lower_region> -->

        <!-- <div class="unrendered" id="tutorial_region"> 
            <div id="tutorial_shadow"></div>
            <div id="tutorial_box">
                <div id="tutorial_close">
                    <img src="../imgs/symbol_x.png">
                </div>
                <div class="header">Create a Custom Fragment</div>
                <div class="tutorial_image"></div>
                <div class="tutorial_header">Select Images for Recto and/or Verso</div>
                <div class="tutorial_text">
                    Choose images for your recto and/or verso by either selecting local images from your hard drive or entering a URL to an image on the web. You can confine yourself to only one side - in this case, the fragment will not be flipped on the table.
                </div>
                <div class="tutorial_image"></div>
                <div class="tutorial_header">Determine Image Resolution</div>
                <div class="tutorial_text">
                    To ensure consistent scaling between fragments, you need to define the images' resolution (how many pixels constitute one centimeter). If not extracted automatically from EXIF data, you can either type the values into the text fields, or determine the correct resolution with the measurement tool. Just select the tool and then click on two spots in the image that have a distance of exactly 1cm.</div>
                <div class="tutorial_image"></div>
                <div class="tutorial_header">Register Recto and Verso</div>
                <div class="tutorial_text">
                    The VLT can only flip fragments correctly and crop the image to the important fragment if it knows where the fragment is and how recto and verso need to be aligned to each other. To achieve this, you can choose from different masking methods. With <b>bounding boxes</b> you can define a minimal bounding rectangle for your fragment. The <b>polygon</b> tool lets you define a custom polygon shape for more precise cropping of the fragment. For alignment, ensure that for both recto and verso the desired fragment is completely encompassed by the polygonal region. The <b>automatic</b> version uses machine learning to segment the image, choose the fragment and automatically align recto and verso to each other.
                </div>
                <div class="tutorial_image"></div>
                <div class="tutorial_header">Provide Name and Upload</div>
                <div class="tutorial_text">
                    As a final step, adapt (or define, if not yet filled in) the name of your custom fragment to your wishes and press "Add to Table". The fragment will now be loaded to the Virtual Light Table.
                </div>
            </div> -->

        </div> <!-- </tutorial_region> -->

        <div id="tpop-select-overlay" class="unrendered">
            <div id="tpop-header">Select Image for <span id="tpop-side"></span></div>
            <div id="tpop-image-list"></div>
            <div id="tpop-buttons">
                <div id="tpop-button-close" class="button large_button">
                    <img draggable="false" src="../imgs/symbol_x.png" class="large_button_img">
                    <div class="large_button_label">Close</div>
                </div>
                <div id="tpop-button-select" class="button large_button disabled">
                    <img draggable="false" src="../imgs/symbol_upload_local.png" class="large_button_img">
                    <div class="large_button_label">Select Image</div>
                </div>
            </div>
        </div>

        <script src="../js/libs/createjs.min.js"></script>
        <script src="../js/libs/preloadjs.min.js"></script>
        <script src="../node_modules/exif-js/exif.js"></script>
        <script src="upload.js"></script>
    </body>
</html>